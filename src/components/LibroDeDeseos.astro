---
// src/components/LibroDeDeseos.astro
import { db } from "../lib/firebase.js";
import { collection, addDoc, serverTimestamp } from "firebase/firestore";

interface Props {
  idInvitado: string;
  nombreInvitado: string;
}

const { idInvitado, nombreInvitado } = Astro.props;

if (Astro.request.method === "POST") {
  const data = await Astro.request.formData();
  const deseo = data.get("deseo");

  if (typeof deseo === 'string' && deseo.trim() !== "") {
    try {
      const deseosRef = collection(db, "deseos");
      await addDoc(deseosRef, {
        idInvitado: idInvitado,
        nombre: nombreInvitado,
        deseo: deseo,
        timestamp: serverTimestamp(),
      });
      return Astro.redirect('/deseos-exito'); // Redirect on success
    } catch (error) {
      console.error("Error al guardar el deseo:", error);
      return Astro.redirect('/deseos-error'); // Redirect on error
    }
} else {
    //Empty desire
    return Astro.redirect('/deseos-error');
}
}
---

<div>
    <form method="POST">
        <label for="deseo" class="block text-sm font-medium text-gray-700">
            Escribe tus deseos para los novios:
        </label>
        <textarea
            id="deseo"
            name="deseo"
            rows={4}
            required
            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
        ></textarea>
        <button
            type="submit"
            class="mt-2 inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
        >
            Enviar Deseo
        </button>
    </form>
</div>